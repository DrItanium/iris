/**
 * This file contains the binding between a given operation and its corresponding
 * format. Update this file when adding new type information
 */
// error is just zero and is not part of a group
// X(name, Format, opcode)
#define Opcode(name, format, opcode) X(name, format, (opcode << 24))
#define Instruction(group, op, Format) X(group ## op, Format)
#define Logical(op, Format) Instruction(Logical, op, Format)
#define Arithmetic(op, Format) Instruction(Arithmetic, op, Format)
#define ArithmeticSigned(op, Format) Arithmetic(op ## Signed, Format)
#define ArithmeticUnsigned(op, Format) Arithmetic(op ## Unsigned, Format)
#define ArithmeticSignedUnsigned(op, Format) \
    ArithmeticSigned(op, Format) \
    ArithmeticUnsigned(op, Format)
#define Memory(op, Format) Instruction(Memory, op, Format)
#define Stack(op, Format) Memory(Stack ## op, Format)
#define Data(op, Format) Memory(Data ## op, Format)
#define Code(op, Format) Memory(Code ## op, Format)
#define IO(op, Format) Memory(IO ## op, Format)
#define Compare(op, Format) Instruction(Compare, op, Format)
#define NormalCompare(op) Compare(op, ThreeRegister)
#define NormalSignedCompare(op) NormalCompare(op ## Signed)
#define NormalUnsignedCompare(op) NormalCompare(op ## Unsigned)
#define NormalSignedUnsignedCompare(op) \
        NormalSignedCompare(op) \
        NormalUnsignedCompare(op)
#define Branch(op, Format) Instruction(Branch, op, Format)
#define GroupArithmetic 0b0000000
#define GroupCompare    0b0010000
#define GroupMemory     0b0100000
#define GroupBranchImm  0b0110000
#define GroupBranchReg  0b1000000
#define GroupLogical    0b1010000
//-----------------------------------------------------------------------------
// Arithmetic
//-----------------------------------------------------------------------------
// Fields are: 0b000,0,K,TTT
// Where:
// C = Major Opcode
// K = Integer? else Ordinal
// T = Operation
#define OpcodeError       0b00000000
#define OpcodeAdd         0b00000001
#define OpcodeSubtract    0b00000010
#define OpcodeMultiply    0b00000011
#define OpcodeDivide      0b00000100
#define OpcodeRemainder   0b00000101
#define OpcodeShiftLeft   0b00000110
#define OpcodeShiftRight  0b00000111

#define KindOrdinal       0b00000000
#define KindInteger       0b00001000
    Opcode(Error,           ZeroRegister,  GroupArithmetic | OpcodeError)
    Opcode(AddOrdinal,      ThreeRegister, GroupArithmetic | OpcodeAdd | KindOrdinal)
    Opcode(AddInteger,      ThreeRegister, GroupArithmetic | OpcodeAdd | KindInteger)
    Opcode(SubtractOrdinal, ThreeRegister, GroupArithmetic | OpcodeSubtract | KindOrdinal)
    Opcode(SubtractInteger, ThreeRegister, GroupArithmetic | OpcodeSubtract | KindInteger)
    Opcode(MultiplyOrdinal, ThreeRegister, GroupArithmetic | OpcodeMultiply | KindOrdinal)
    Opcode(MultiplyInteger, ThreeRegister, GroupArithmetic | OpcodeMultiply | KindInteger)
    Opcode(DivideOrdinal,   ThreeRegister, GroupArithmetic | OpcodeDivide | KindOrdinal)
    Opcode(DivideInteger,   ThreeRegister, GroupArithmetic | OpcodeDivide | KindInteger)
    Opcode(RemainderOrdinal,   ThreeRegister, GroupArithmetic | OpcodeRemainder | KindOrdinal)
    Opcode(RemainderInteger,   ThreeRegister, GroupArithmetic | OpcodeRemainder | KindInteger)
    Opcode(ShiftLeftOrdinal,   ThreeRegister, GroupArithmetic | OpcodeShiftLeft | KindOrdinal)
    Opcode(ShiftLeftInteger,   ThreeRegister, GroupArithmetic | OpcodeShiftLeft | KindInteger)
    Opcode(ShiftRightOrdinal,   ThreeRegister, GroupArithmetic | OpcodeShiftRight | KindOrdinal)
    Opcode(ShiftRightInteger,   ThreeRegister, GroupArithmetic | OpcodeShiftRight | KindInteger)
    ArithmeticSignedUnsigned(Add, ThreeRegister)
    ArithmeticSignedUnsigned(Subtract, ThreeRegister)
    ArithmeticSignedUnsigned(Multiply, ThreeRegister)
    ArithmeticSignedUnsigned(Divide, ThreeRegister)
    ArithmeticSignedUnsigned(Remainder, ThreeRegister)
    ArithmeticSignedUnsigned(ShiftLeft, ThreeRegister)
    ArithmeticSignedUnsigned(ShiftRight, ThreeRegister)
//-----------------------------------------------------------------------------
// Logical
//-----------------------------------------------------------------------------
    Logical(BitwiseNot, TwoRegister)
    Logical(BitwiseAnd, ThreeRegister)
    Logical(BitwiseOr, ThreeRegister)
    Logical(BitwiseXor, ThreeRegister)
//-----------------------------------------------------------------------------
// Memory
//-----------------------------------------------------------------------------
    Memory(AssignRegisterImmediate, OneRegisterU16)
    Stack(Push, TwoRegister)
    Stack(Pop, TwoRegister)
    Data(LoadWithOffset, TwoRegisterU8)
    Data(StoreWithOffset, TwoRegisterU8)
    Code(LoadWithOffset, TwoRegisterU8)
    Code(StoreWithOffset, TwoRegisterU8)
    IO(LoadWithOffset, TwoRegisterU8)
    IO(StoreWithOffset, TwoRegisterU8)
//-----------------------------------------------------------------------------
// Compare
//-----------------------------------------------------------------------------
    X(CompareOrdinal, ThreeRegister)
    X(CompareInteger, ThreeRegister)
//-----------------------------------------------------------------------------
// Branch
//-----------------------------------------------------------------------------
    // all unconditional one way branches are redefined in terms of the conditional
    // versions
    Branch(ConditionalImmediate, OneRegisterU16)
    Branch(ConditionalRelativeImmediate, OneRegisterS16)
    Branch(RelativeImmediateAndLink, OneRegisterS16)
    Branch(ImmediateAndLink, OneRegisterU16)
    Branch(ConditionalRegisterAndLink, ThreeRegister)
//-----------------------------------------------------------------------------


#undef NormalSignedCompare
#undef NormalUnsignedCompare 
#undef NormalCompare
#undef NormalSignedUnsignedCompare

#undef Compare
#undef Instruction

#undef ArithmeticSignedImmediate
#undef ArithmeticUnsignedImmediate
#undef Arithmetic
#undef ArithmeticSigned
#undef ArithmeticUnsigned
#undef ArithmeticSignedUnsigned
#undef Branch
#undef Stack
#undef Data
#undef Code
#undef IO
#undef Memory
#undef ArithmeticSignedUnsignedImmediate
#undef Logical
#undef Opcode
